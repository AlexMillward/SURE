<xmodel version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation='http://flame.ac.uk/schema/xmml_v2.xsd'>

  <name>Model of a production firm</name>
  <version>0.0.1</version>
  <description>Alex Millward, 2015</description>

  <environment>

    <functionFiles>

      <!-- Agent functions -->
      <file>Division_functions.c</file>
      <file>Firm_functions.c</file>
      <file>Retailer_functions.c</file>

      <!-- Helper functions -->
      <file>Division_helpers.c</file>

    </functionFiles>

    <dataTypes>

      <dataType>
        <name>division_output_inventory</name>
        <description>The output inventory of a firm division</description>
        <variables>
          <variable><type>int</type><name>current</name></variable>
          <variable><type>int</type><name>target</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_production_inventory_component</name>
        <description>A description of a component of a division's production inventory</description>
        <variables>
          <variable><type>int</type><name>good_id</name></variable>
          <variable><type>int</type><name>current</name></variable>
          <variable><type>int</type><name>target</name></variable>
          <variable><type>int</type><name>ordered</name></variable>
          <variable><type>int</type><name>restock_level</name></variable>
          <variable><type>int</type><name>requirement_per_unit_output</name></variable>
          <variable><type>double</type><name>latest_unit_cost</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_funding</name>
        <description>Listings of funding made available to the division</description>
        <variables>
          <variable><type>double</type><name>production</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_costs</name>
        <descriptions>A description of a division's costs</descriptions>
        <variables>
          <variable><type>double</type><name>unit</name></variable>
          <variable><type>double</type><name>running</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_physical_capital</name>
        <description>A description of a division's physical capital</description>
        <variables>
          <variable><type>int</type><name>quantity</name></variable>
          <variable><type>int</type><name>production_per_unit</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_human_capital</name>
        <description>A description of a division's human capital</description>
        <variables>
          <variable><type>int</type><name>quantity</name></variable>
          <variable><type>int</type><name>production_per_unit</name></variable>
          <variable><type>double</type><name>mean_wage</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_output_information</name>
        <description>Information about a firm division's output and output potential</description>
        <variables>
          <variable><type>int</type><name>physical_capital_potential</name></variable>
          <variable><type>int</type><name>human_capital_potential</name></variable>
          <variable><type>int</type><name>production_inventory_potential</name></variable>
          <variable><type>int</type><name>funding_potential</name></variable>
          <variable><type>int</type><name>potential</name></variable>
          <variable><type>int</type><name>actual</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_transport_information</name>
        <description>Information about transporting a division's goods</description>
        <variables>
          <variable><type>double</type><name>x_position</name></variable>
          <variable><type>double</type><name>y_position</name></variable>
          <variable><type>double</type><name>vehicle_speed</name></variable>
          <variable><type>double</type><name>unit_cost_per_day</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_transport_quote</name>
        <description>A quote for delivery costs and time</description>
        <variables>
          <variable><type>double</type><name>cost</name></variable>
          <variable><type>int</type><name>time</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_offer_information</name>
        <description>Information about an offer of output by a division</description>
        <variables>
          <variable><type>int</type><name>source_id</name></variable>
          <variable><type>int</type><name>good_id</name></variable>
          <variable><type>int</type><name>inventory_number</name></variable>
          <variable><type>int</type><name>quantity</name></variable>
          <variable><type>double</type><name>overall_cost</name></variable>
          <variable><type>double</type><name>cost_before_transport</name></variable>
          <variable><type>int</type><name>delivery_time</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>division_delivery</name>
        <description>A description of a delivery being made to a division</description>
        <variables>
          <variable><type>int</type><name>inventory_number</name></variable>
          <variable><type>int</type><name>quantity</name></variable>
          <variable><type>int</type><name>time_remaining</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>product_sales_information</name>
        <description>Sales information about a product</description>
        <variables>
          <variable><type>int</type><name>expectation</name></variable>
          <variable><type>int</type><name>so_far</name></variable>
          <variable><type>double</type><name>expected_percentage_increase</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>firm_product</name>
        <description>A product produced by a firm</description>
        <variables>
          <variable><type>int</type><name>good_id</name></variable>
          <variable><type>double</type><name>running_costs_allocation</name></variable>
          <variable><type>double</type><name>running_costs_per_unit</name></variable>
          <variable><type>double</type><name>percentage_profit_target</name></variable>
          <variable><type>product_sales_information</type><name>sales</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>firm_cost_information</name>
        <description>Cost information for a firm</description>
        <variables>
          <variable><type>double</type><name>unit_cost</name></variable>
          <variable><type>double</type><name>running_costs_per_unit</name></variable>
          <variable><type>double</type><name>profit_estimate</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>retailer_product</name>
        <description>A product sold by a retailer</description>
        <variables>
          <variable><type>int</type><name>good_id</name></variable>
          <!-- stock -->
          <variable><type>int</type><name>stock</name></variable>
          <variable><type>int</type><name>ordered</name></variable>
          <variable><type>int</type><name>units_sold_per_day</name></variable>
          <variable><type>int</type><name>restock_depletion_time</name></variable>
          <variable><type>int</type><name>target_depletion_time</name></variable>
          <!-- demand variables -->
          <variable><type>double</type><name>percentage_profit_target</name></variable>
          <variable><type>double</type><name>price_elasticity_of_demand</name></variable>
          <variable><type>double</type><name>zero_demand_price</name></variable>
        </variables>
      </dataType>

      <dataType>
        <name>retailer_requirement</name>
        <description>A description of one of a retailer's requirements</description>
        <variables>
          <variable><type>int</type><name>product_number</name></variable>
          <variable><type>int</type><name>depletion_time</name></variable>
          <variable><type>int</type><name>best_firm_id</name></variable>
          <variable><type>int</type><name>best_division_id</name></variable>
          <variable><type>double</type><name>best_price</name></variable>
          <variable><type>int</type><name>best_quantity</name></variable>
          <variable><type>firm_cost_information</type><name>best_cost_information</name></variable>
          <variable><type>int</type><name>best_delivery_time</name></variable>
        </variables>
      </dataType>

    </dataTypes>

  </environment>
  <agents>

    <xagent>

      <name>Division</name>
      <description>A division of a firm</description>

      <memory>
        <!-- Identity details -->
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>id</name></variable>

        <!-- Production details -->
        <variable><type>int</type><name>output_good_id</name></variable>
        <variable><type>double</type><name>production_costs_per_unit</name></variable>

        <!-- == data structures == -->
        <variable><type>division_output_inventory</type><name>output_inventory</name></variable>
        <variable><type>division_production_inventory_component_array</type><name>production_inventory</name></variable>
        <variable><type>division_costs</type><name>costs</name></variable>
        <variable><type>division_funding</type><name>funding</name></variable>
        <variable><type>division_physical_capital</type><name>physical_capital</name></variable>
        <variable><type>division_human_capital</type><name>human_capital</name></variable>
        <variable><type>division_output_information</type><name>output_information</name></variable>
        <variable><type>division_transport_information</type><name>transport_information</name></variable>
        <variable><type>division_delivery_array</type><name>deliveries</name></variable>
      </memory>

      <functions>

        <function>
          <name>produce</name>
          <description>Computes production for a single time unit (day)</description>
          <currentState>0</currentState>
          <nextState>1</nextState>
        </function>

        <function>
          <name>stateProductionInventoryRequirements</name>
          <description>State to other divisions current restocking requirements</description>
          <currentState>1</currentState>
          <nextState>2</nextState>
          <outputs>
            <output><messageName>division_requirement</messageName></output>
          </outputs>
        </function>

        <function>
          <name>offerOutput</name>
          <description>Offer the divison's output to another division</description>
          <currentState>2</currentState>
          <nextState>3</nextState>
          <inputs>
            <input>
              <messageName>division_requirement</messageName>
              <filter>
                <lhs>
                  <lhs><value>a.firm_id</value></lhs>
                  <op>EQ</op>
                  <rhs><value>m.firm_id</value></rhs>
                </lhs>
                <op>AND</op>
                <rhs>
                  <lhs>
                    <lhs><value>a.id</value></lhs>
                    <op>NEQ</op>
                    <rhs><value>m.division_id</value></rhs>
                  </lhs>
                  <op>AND</op>
                  <rhs>
                    <lhs><value>a.output_good_id</value></lhs>
                    <op>EQ</op>
                    <rhs><value>m.good_id</value></rhs>
                  </rhs>
                </rhs>
              </filter>
            </input>
          </inputs>
          <outputs>
            <output><messageName>division_offer</messageName></output>
          </outputs>
        </function>

        <function>
          <name>processOffers</name>
          <description>Process offers made to the division</description>
          <currentState>3</currentState>
          <nextState>4</nextState>
          <inputs>
            <input>
              <messageName>division_offer</messageName>
              <filter>
                <lhs>
                  <lhs><value>a.firm_id</value></lhs>
                  <op>EQ</op>
                  <rhs><value>m.firm_id</value></rhs>
                </lhs>
                <op>AND</op>
                <rhs>
                  <lhs><value>a.id</value></lhs>
                  <op>EQ</op>
                  <rhs><value>m.target_id</value></rhs>
                </rhs>
              </filter>
            </input>
          </inputs>
          <outputs>
            <output><messageName>division_acceptance</messageName></output>
          </outputs>
        </function>

        <function>
          <name>processAcceptances</name>
          <description>Process offer acceptances made to the division</description>
          <currentState>4</currentState>
          <nextState>5</nextState>
          <inputs>
            <input>
              <messageName>division_acceptance</messageName>
              <filter>
                <lhs>
                  <lhs><value>a.firm_id</value></lhs>
                  <op>EQ</op>
                  <rhs><value>m.firm_id</value></rhs>
                </lhs>
                <op>AND</op>
                <rhs>
                  <lhs><value>a.id</value></lhs>
                  <op>EQ</op>
                  <rhs><value>m.source_id</value></rhs>
                </rhs>
              </filter>
            </input>
          </inputs>
        </function>

        <function>
          <name>updateDeliveries</name>
          <description>Update deliveries to the division</description>
          <currentState>5</currentState>
          <nextState>6</nextState>
        </function>

        <function>
          <name>updateAndStateCosts</name>
          <description>Update and state a division's costs</description>
          <currentState>6</currentState>
          <nextState>7</nextState>
          <outputs>
            <output><messageName>division_costs</messageName></output>
          </outputs>
        </function>

        <function>
          <name>stateOutputAvailability</name>
          <description>State the availability of a firm's output to the market</description>
          <currentState>7</currentState>
          <nextState>8</nextState>
          <outputs>
            <output><messageName>division_availability</messageName></output>
          </outputs>
        </function>

      </functions>

    </xagent>

    <xagent>

      <name>Firm</name>
      <description>A firm</description>

      <memory>

        <!-- Identity details -->
        <variable><type>int</type><name>id</name></variable>

        <!-- Costs details -->
        <variable><type>double</type><name>running_costs</name></variable>

        <!-- == data structures == -->
        <variable><type>firm_product_array</type><name>products</name></variable>

      </memory>

      <functions>

        <function>
          <name>calculateCosts</name>
          <description>Calculate a firm's running costs and how to allocate them amongst products</description>
          <currentState>0</currentState>
          <nextState>1</nextState>
          <inputs>
            <input>
              <messageName>division_costs</messageName>
              <filter>
                <lhs><value>a.id</value></lhs>
                <op>EQ</op>
                <rhs><value>m.firm_id</value></rhs>
              </filter>
            </input>
          </inputs>
        </function>

        <function>
          <name>processOutputAvailability</name>
          <description>Calculate the availability of a firm's output, and the appropriate price</description>
          <currentState>1</currentState>
          <nextState>2</nextState>
          <inputs>
            <input>
              <messageName>division_availability</messageName>
              <filter>
                <lhs><value>a.id</value></lhs>
                <op>EQ</op>
                <rhs><value>m.firm_id</value></rhs>
              </filter>
            </input>
          </inputs>
          <outputs>
            <output><messageName>firm_availability</messageName></output>
          </outputs>
        </function>

        <function>
          <name>processOrders</name>
          <description>Process orders from the market made to the firm</description>
          <currentState>2</currentState>
          <nextState>3</nextState>
          <inputs>
            <input><messageName>product_order</messageName></input>
          </inputs>
        </function>

      </functions>

    </xagent>

    <xagent>

      <name>Retailer</name>
      <description>A retailer</description>

      <memory>

        <!-- Identity details -->
        <variable><type>int</type><name>id</name></variable>

        <!-- Position details -->
        <variable><type>double</type><name>x_position</name></variable>
        <variable><type>double</type><name>y_position</name></variable>

        <!-- == data structure == -->
        <variable><type>retailer_product_array</type><name>retailer_products</name></variable>

      </memory>

      <function>
        <name>restock</name>
        <description>Check if restocks are required and if so handle them</description>
        <currentState>0</currentState>
        <nextState>1</nextState>
        <inputs>
          <input><messageName>firm_availability</messageName></input>
        </inputs>
        <outputs>
          <output><messageName>product_order</messageName></output>
        </outputs>
      </function>

    </xagent>

  </agents>
  <messages>

    <message>
      <name>division_requirement</name>
      <variables>
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>division_id</name></variable>
        <variable><type>int</type><name>good_id</name></variable>
        <variable><type>int</type><name>inventory_number</name></variable>
        <variable><type>int</type><name>quantity</name></variable>
        <variable><type>double</type><name>x_position</name></variable>
        <variable><type>double</type><name>y_position</name></variable>
      </variables>
    </message>

    <message>
      <name>division_offer</name>
      <variables>
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>source_id</name></variable>
        <variable><type>int</type><name>target_id</name></variable>
        <variable><type>int</type><name>good_id</name></variable>
        <variable><type>int</type><name>inventory_number</name></variable>
        <variable><type>int</type><name>quantity</name></variable>
        <variable><type>double</type><name>overall_cost</name></variable>
        <variable><type>double</type><name>cost_before_transport</name></variable>
        <variable><type>int</type><name>delivery_time</name></variable>
      </variables>
    </message>

    <message>
      <name>division_acceptance</name>
      <variables>
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>source_id</name></variable>
        <variable><type>int</type><name>quantity</name></variable>
        <variable><type>double</type><name>cost_before_transport</name></variable>
      </variables>
    </message>

    <message>
      <name>division_costs</name>
      <variables>
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>double</type><name>running_costs</name></variable>
      </variables>
    </message>

    <message>
      <name>division_availability</name>
      <variables>
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>division_id</name></variable>
        <variable><type>int</type><name>good_id</name></variable>
        <variable><type>int</type><name>quantity</name></variable>
        <variable><type>double</type><name>unit_cost</name></variable>
        <variable><type>division_transport_information</type><name>transport_information</name></variable>
      </variables>
    </message>

    <message>
      <name>firm_availability</name>
      <variables>
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>division_id</name></variable>
        <variable><type>int</type><name>good_id</name></variable>
        <variable><type>int</type><name>quantity</name></variable>
        <variable><type>firm_cost_information</type><name>cost_information</name></variable>
        <variable><type>double</type><name>price</name></variable>
        <variable><type>division_transport_information</type><name>transport_information</name></variable>
      </variables>
    </message>

    <message>
      <name>product_order</name>
      <variables>
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>division_id</name></variable>
        <variable><type>int</type><name>good_id</name></variable>
        <variable><type>double</type><name>price</name></variable>
        <variable><type>int</type><name>quantity</name></variable>
        <variable><type>firm_cost_information</type><name>cost_information</name></variable>
        <variable><type>int</type><name>delivery_time</name></variable>
      </variables>
    </message>

  </messages>
</xmodel>
