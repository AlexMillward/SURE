<xmodel version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation='http://flame.ac.uk/schema/xmml_v2.xsd'>
  <name>Basic model</name>
  <version>1</version>
  <environment>
    <functionFiles>
      <file>Division_functions.c</file>
      <file>Division_helpers.c</file>
      <file>Firm_functions.c</file>
    </functionFiles>
    <timeUnits>

      <timeUnit>
        <name>daily</name>
        <unit>iteration</unit>
        <period>1</period>
      </timeUnit>

      <timeUnit>
        <name>weekly</name>
        <unit>daily</unit>
        <period>7</period>
      </timeUnit>

      <timeUnit>
        <name>monthly</name>
        <unit>weekly</unit>
        <period>4</period>
      </timeUnit>

    </timeUnits>
    <dataTypes>

      <!-- firm product wrapper -->
      <dataType>
        <name>product</name>
        <variables>
          <variable><type>int</type><name>good_type</name></variable>
          <variable><type>double</type><name>unit_production_cost</name></variable>
          <variable><type>int</type><name>sales_expectation</name></variable>
          <variable><type>double</type><name>running_costs_contribution</name></variable>
          <variable><type>double</type><name>price</name></variable>
        </variables>
      </dataType>

      <!-- production dependency wrapper -->
      <dataType>
        <name>dependency</name>
        <variables>
          <variable><type>int</type><name>good_type</name></variable>
          <variable><type>int</type><name>stock</name></variable>
          <variable><type>int</type><name>required_per_unit</name></variable>
        </variables>
      </dataType>

      <!-- order wrapper -->
      <dataType>
        <name>order</name>
        <variables>
          <variable><type>int</type><name>buyer_id</name></variable>
          <variable><type>int</type><name>quantity</name></variable>
        </variables>
      </dataType>

      <!-- delivery wrapper -->
      <dataType>
        <name>delivery</name>
        <variables>
          <variable><type>int</type><name>good_type</name></variable>
          <variable><type>int</type><name>quantity</name></variable>
          <variable><type>int</type><name>time_remaining</name></variable>
        </variables>
      </dataType>

      <!-- division cost information -->
      <dataType>
        <name>division_cost_information</name>
        <variables>
          <variable><type>int</type><name>id</name></variable>
          <variable><type>int</type><name>good_type</name></variable>
          <variable><type>double</type><name>production_costs_per_unit</name></variable>
          <variable><type>int</type><name>dependencies[5]</name></variable>
        </variables>
      </dataType>

    </dataTypes>
  </environment>
  <agents>

    <!-- Firm agent -->
    <xagent>
      <name>Firm</name>
      <description>A production firm</description>
      <memory>

        <!-- identity -->
        <variable><type>int</type><name>id</name></variable>
        <variable><type>product_array</type><name>products</name></variable>

        <!-- costs -->
        <variable><type>double</type><name>running_costs</name></variable>

      </memory>
      <functions>

        <!-- decide on prices -->
        <function>
          <name>decidePrices</name>
          <description>Decide on prices for each product based on costs</description>
          <currentState>0</currentState>
          <nextState>1</nextState>
        </function>

      </functions>
    </xagent>

    <!-- Division agent -->
    <xagent>
      <name>Division</name>
      <description>A division of a firm</description>
      <memory>

        <!-- identity -->
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>id</name></variable>

        <!-- costs -->
        <variable><type>double</type><name>running_costs</name></variable>
        <variable><type>double</type><name>unit_costs</name></variable>

        <!-- administrative -->
        <variable><type>order</type><name>current_order</name></variable>
        <variable><type>double</type><name>funds</name></variable>
        <variable><type>double</type><name>reserved_funds</name></variable>
        <variable><type>int</type><name>stock</name></variable>
        <variable><type>double</type><name>mean_wage</name></variable>

        <!-- production -->
        <variable><type>int</type><name>produces_good_of_type</name></variable>
        <variable><type>dependency_array</type><name>dependencies</name></variable>
        <variable><type>double</type><name>production_costs_per_unit</name></variable>

        <!-- assets -->
        <variable><type>int</type><name>employees</name></variable>
        <variable><type>int</type><name>quantity_of_capital</name></variable>
        <variable><type>int</type><name>output_potential_per_employee</name></variable>
        <variable><type>int</type><name>output_potential_per_capital_unit</name></variable>

        <!-- output -->
        <variable><type>int</type><name>dependency_output_potential</name></variable>
        <variable><type>int</type><name>employee_output_potential</name></variable>
        <variable><type>int</type><name>capital_output_potential</name></variable>
        <variable><type>int</type><name>funds_output_potential</name></variable>
        <variable><type>int</type><name>output_potential</name></variable>
        <variable><type>int</type><name>output</name></variable>

        <!-- delivery -->
        <variable><type>delivery_array</type><name>deliveries</name></variable>
        <variable><type>int</type><name>transport_quantity</name></variable>
        <variable><type>int</type><name>transportable_daily</name></variable>
        <variable><type>double</type><name>x_position</name></variable>
        <variable><type>double</type><name>y_position</name></variable>

      </memory>
      <functions>

        <!-- function to broadcast division information -->
        <function>
          <name>stateInformation</name>
          <description>State division costs and dependencies</description>
          <currentState>0</currentState>
          <nextState>1</nextState>
          <outputs>
            <output><messageName>division_information</messageName></output>
          </outputs>
        </function>

        <!-- determine unit costs -->
        <function>
          <name>determineUnitCosts</name>
          <description>Determine the division's unit costs</description>
          <currentState>1</currentState>
          <nextState>2</nextState>
          <inputs>
            <input><messageName>division_information</messageName></input>
          </inputs>
        </function>

        <!-- state unit costs -->
        <function>
          <name>stateUnitCosts</name>
          <description>State the divison's unit costs</description>
          <currentState>2</currentState>
          <nextState>3</nextState>
          <outputs>
            <output><messageName>division_unit_costs</messageName></output>
          </outputs>
        </function>

        <!-- function representing delivery (dispatch of goods) -->
        <function>
          <name>deliver</name>
          <description>Deliver goods from previous iteration (day)</description>
          <currentState>3</currentState>
          <nextState>4</nextState>
          <outputs>
            <output><messageName>delivery</messageName></output>
          </outputs>
        </function>

        <!-- handle incoming deliveries (represents alerting buyer of dispatch) -->
        <function>
          <name>handleDeliveries</name>
          <description>Handle incoming delivery messages</description>
          <currentState>4</currentState>
          <nextState>5</nextState>
          <inputs>
            <input><messageName>delivery</messageName></input>
          </inputs>
        </function>

        <!-- function to update current deliveries (represents movement of goods) -->
        <function>
          <name>updateDeliveries</name>
          <description>Update deliveries that are en route</description>
          <currentState>5</currentState>
          <nextState>6</nextState>
        </function>

        <!-- function to run production for the current order -->
        <function>
          <name>produce</name>
          <description>Run production process</description>
          <currentState>6</currentState>
          <nextState>7</nextState>
        </function>

      </functions>
    </xagent>
  </agents>
  <messages>

    <!-- message containing delivery information, sent from producer to buyer -->
    <message>
      <name>delivery</name>
      <variables>
        <variable><type>int</type><name>destination_id</name></variable>
        <variable><type>int</type><name>good_type</name></variable>
        <variable><type>int</type><name>quantity</name></variable>
        <variable><type>double</type><name>origin_x</name></variable>
        <variable><type>double</type><name>origin_y</name></variable>
      </variables>
    </message>

    <!-- message containing division information -->
    <message>
      <name>division_information</name>
      <variables>
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>id</name></variable>
        <variable><type>int</type><name>good_type</name></variable>
        <variable><type>double</type><name>running_costs</name></variable>
        <variable><type>double</type><name>production_costs_per_unit</name></variable>
        <variable><type>int</type><name>dependencies[5]</name></variable>
      </variables>
    </message>

    <!-- message containing division unit costs -->
    <message>
      <name>division_status</name>
      <variables>
        <variable><type>int</type><name>firm_id</name></variable>
        <variable><type>int</type><name>id</name></variable>
        <variable><type>double</type><name>unit_costs</name></variable>
      </variables>
    </message>

  </messages>
</xmodel>
